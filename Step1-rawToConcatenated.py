""" 
Command line utility for concatenating the csv files in the subfolders of 'The Hague 2 - DATASET 1(Original)' 
usage example:
$ python concat_csv.py /home/erik/DM806-IndividueltProjekt/The\ Hauge\ 2\ -\ DATASET\ 1\(original\)/K051 concatenated/
"""
import os
import sys
import pandas as pd


def concat_csv(folder, out_folder):
    """For integrating the files in a subfolder of the new data"""
    old_dir = os.getcwd()
    os.chdir(folder)
    df_name = folder[-4:]
    files = [f for f in os.listdir() if f[-3:] == "csv"]
    frames = [
        pd.read_csv(
            f,
            sep=";",
            parse_dates=[df_name],
            index_col=df_name,
            skipfooter=1,
            engine="python",
        )
        for f in files
    ]
    df = pd.concat(frames)
    df.name = df_name
    df = df[relevant_sensors[df.name]]
    # set to old folder
    os.chdir(out_folder)
    df.to_csv(df_name + ".csv")
    os.chdir(old_dir)


relevant_sensors = {
    "K051": [
        "051",
        "052",
        "021",
        "022",
        "112",
        "082",
        "081",
    ],
    "K074": ["111", "112", "081", "082", "051", "052", "022", "021"],
    "K101": [
        "711",
        "721",
        "621",
        "622",
        "631",
        "641",
        "651",
        "681",
        "682",
    ],
    "K102": [
        "101",
        "111",
        "121",
        "021",
        "022",
        "031",
        "051",
        "061",
        "081",
        "082",
        "091",
    ],
    "K104": [
        "111",
        "021",
        "022",
        "031",
        "051",
        "081",
        "082",
        "091",
    ],
    "K128": [
        "051",
        "061",
        "062",
        "071",
        "072",
        "081",
        "082",
        "142",
        "141",
        "131",
        "171",
        "162",
        "161",
        "111",
        "113",
        "112",
        "021",
        "011",
        "022",
    ],
    "K139": [
        "101",
        "121",
        "011",
        "021",
        "022",
        "081",
        "082",
        "091",
    ],
    "K159": [
        "081",
        "111",
        "112",
        "021",
        "022",
        "051",
        "052",
    ],
    "K182": [
        "081",
        "082",
        "621",
        "622",
        "041",
        "691",
        "682",
        "681",
        "631",
        "101",
        "121",
        "021",
        "022",
    ],
    "K183": [
        "051",
        "081",
        "082",
        "091",
        "111",
        "021",
        "022",
        "031",
    ],
    "K198": ["081", "111", "121", "021", "051", "052", "061"],
    "K206": [
        "092",
        "091",
        "082",
        "081",
        "071",
        "061",
        "051",
        "052",
        "031",
        "022",
        "021",
        "101",
        "111",
        "112",
        "121",
    ],
    "K250": [
        "051",
        "052",
        "053",
        "081",
        "091",
        "092",
        "101",
        "102",
        "111",
        "112",
        "121",
        "021",
        "022",
    ],
    "K263": [
        "041",
        "051",
        "052",
        "062",
        "081",
        "101",
        "111",
        "112",
        "121",
        "021",
        "031",
    ],
    "K301": [
        "151",
        "152",
        "041",
        "042",
        "051",
        "052",
        "654",
        "653",
        "652",
        "651",
        "633",
        "632",
        "631",
        "122",
        "121",
        "112",
        "111",
        "032",
        "031",
        "012",
        "011",
    ],
    "K304": [
        "041",
        "051",
        "052",
        "081",
        "082",
        "031",
        "021",
        "011",
        "111",
        "112",
        "121",
    ],
    "K305": [
        "041",
        "042",
        "051",
        "052",
        "061",
        "032",
        "031",
        "012",
        "011",
        "111",
        "112",
        "121",
        "122",
    ],
    "K405": [
        "071",
        "081",
        "082",
        "091",
        "111",
        "112",
        "021",
        "022",
        "031",
        "032",
        "641",
        "651",
        "661",
        "721",
        "712",
        "711",
        "681",
        "715",
        "051",
        "041",
    ],
    "K406": ["081", "082", "091", "101", "121", "011", "021", "022", "221"],
    "K414": [
        "092",
        "091",
        "082",
        "081",
        "071",
        "101",
        "111",
        "121",
        "122",
        "011",
        "012",
        "021",
        "022",
        "031",
        "051",
        "061",
    ],
    "K415": ['081', '071', '021', '031', '061', '041'],
    "K502": [
        "071",
        "081",
        "082",
        "091",
        "111",
        "011",
        "021",
        "022",
        "031",
        "052",
        "051",
    ],
    "K503": [
        "041",
        "051",
        "052",
        "061",
        "071",
        "081",
        "091",
        "101",
        "111",
        "112",
        "121",
        "031",
        "021",
    ],
    "K504": [
        "071",
        "081",
        "082",
        "091",
        "111",
        "112",
        "121",
        "122",
        "011",
        "012",
        "021",
        "022",
        "031",
        "041",
        "042",
        "051",
        "052",
        "061",
    ],
    "K556": [
        "071",
        "081",
        "082",
        "091",
        "101",
        "111",
        "011",
        "021",
        "022",
        "031",
        "051",
        "041",
    ],
    "K557": [
        "101",
        "111",
        "011",
        "021",
        "022",
        "031",
        "071",
        "081",
        "082",
        "091",
    ],
    "K559": [
        "091",
        "082",
        "081",
        "101",
        "121",
        "011",
        "021",
        "022",
    ],
    "K561": [
        "071",
        "081",
        "082",
        "091",
        "101",
        "111",
        "112",
        "121",
        "011",
        "021",
        "022",
        "031",
        "032",
        "041",
        "051",
        "052",
        "061",
    ],
    "K702": [
        "111",
        "112",
        "121",
        "011",
        "031",
        "041",
        "051",
        "052",
    ],
    "K703": [
        "111",
        "112",
        "021",
        "022",
        "031",
        "051",
        "052",
        "081",
        "082",
        "091",
    ],
    "K704": [
        "051",
        "052",
        "061",
        "071",
        "091",
        "092",
        "701",
        "711",
        "712",
        "661",
        "652",
        "651",
        "031",
        "021",
        "113",
        "112",
        "111",
        "691",
        "681",
        "672",
        "671",
    ],
}

if __name__ == "__main__":
    folder = sys.argv[1]
    out_folder = sys.argv[2]
    try:
        os.mkdir(out_folder)
        print("Created folder.")
    except Exception:
        pass
    print("Reading from: {}".format(folder))
    print("Writing into: {}".format(out_folder))
    concat_csv(folder, out_folder)
